import * as Comlink from "/wasmsharp/comlink.mjs";
import { WasmSharpWorker } from "./WasmSharpWorker.js";
export class WasmSharpModule {
    worker;
    constructor(worker) {
        this.worker = worker;
    }
    static async initializeAsync(options) {
        //TODO: Rewrite this using dynamic import so that we do not load web worker code when its disabled, and vice versa.
        if (options?.disableWebWorker) {
            const module = await WasmSharpWorker.initializeAsync(options, {
                onConfigLoaded: options?.onConfigLoaded,
                onDownloadResourceProgress: options?.onDownloadResourceProgress,
            });
            return new WasmSharpModule(module);
        }
        else {
            const worker = new Worker(new URL("./worker.js", import.meta.url).href, { type: "module" });
            const WorkerClass = Comlink.wrap(worker);
            //functions are not structured cloneable
            if (options?.onConfigLoaded || options?.onDownloadResourceProgress) {
                const onConfigLoaded = options.onConfigLoaded;
                const onDownloadResourceProgress = options.onDownloadResourceProgress;
                worker.addEventListener("message", (e) => {
                    if (e.data.type && e.data.type === "configLoaded" && e.data.config) {
                        onConfigLoaded?.(e.data.config);
                    }
                    if (e.data.type && e.data.type === "downloadResourceProgress") {
                        onDownloadResourceProgress?.(e.data.loadedResources, e.data.totalResources);
                    }
                });
                delete options.onConfigLoaded;
                delete options.onDownloadResourceProgress;
            }
            const module = await new WorkerClass();
            await module.initializeAsync(options);
            return new WasmSharpModule(module);
        }
    }
    createCompilationAsync = async (code) => await this.worker.createCompilationAsync(code);
}
export * from "./Roslyn/Text.js";
export * from "./Roslyn/WellKnownTags.js";
export * from "./WasmSharpWorker.js";
export { Compilation } from "./Compilation.js";
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiV2FzbUNvbXBpbGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vV2FzbUNvbXBpbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUdBLE9BQU8sS0FBSyxPQUFPLE1BQU0sZ0RBQWdELENBQUM7QUFDMUUsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBMkN2RCxNQUFNLE9BQU8sZUFBZTtJQUNOO0lBQXBCLFlBQW9CLE1BQW9EO1FBQXBELFdBQU0sR0FBTixNQUFNLENBQThDO0lBQUcsQ0FBQztJQUM1RSxNQUFNLENBQUMsS0FBSyxDQUFDLGVBQWUsQ0FBQyxPQUEwQjtRQUNyRCxtSEFBbUg7UUFDbkgsSUFBSSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQztZQUM5QixNQUFNLE1BQU0sR0FBRyxNQUFNLGVBQWUsQ0FBQyxlQUFlLENBQUMsT0FBTyxFQUFFO2dCQUM1RCxjQUFjLEVBQUUsT0FBTyxFQUFFLGNBQWM7Z0JBQ3ZDLDBCQUEwQixFQUFFLE9BQU8sRUFBRSwwQkFBMEI7YUFDaEUsQ0FBQyxDQUFDO1lBQ0gsT0FBTyxJQUFJLGVBQWUsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUNyQyxDQUFDO2FBQU0sQ0FBQztZQUNOLE1BQU0sTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLElBQUksR0FBRyxDQUFDLGFBQWEsRUFBRSxNQUFNLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsQ0FBQyxDQUFDO1lBQzVGLE1BQU0sV0FBVyxHQUFHLE9BQU8sQ0FBQyxJQUFJLENBQTRCLE1BQU0sQ0FBQyxDQUFDO1lBRXBFLHdDQUF3QztZQUN4QyxJQUFJLE9BQU8sRUFBRSxjQUFjLElBQUksT0FBTyxFQUFFLDBCQUEwQixFQUFFLENBQUM7Z0JBQ25FLE1BQU0sY0FBYyxHQUFHLE9BQU8sQ0FBQyxjQUFjLENBQUM7Z0JBQzlDLE1BQU0sMEJBQTBCLEdBQUcsT0FBTyxDQUFDLDBCQUEwQixDQUFDO2dCQUN0RSxNQUFNLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUU7b0JBQ3ZDLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssY0FBYyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUM7d0JBQ25FLGNBQWMsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLENBQUM7b0JBQ2xDLENBQUM7b0JBRUQsSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSywwQkFBMEIsRUFBRSxDQUFDO3dCQUM5RCwwQkFBMEIsRUFBRSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsZUFBZSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7b0JBQzlFLENBQUM7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsT0FBTyxPQUFPLENBQUMsY0FBYyxDQUFDO2dCQUM5QixPQUFPLE9BQU8sQ0FBQywwQkFBMEIsQ0FBQztZQUM1QyxDQUFDO1lBRUQsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFJLFdBQVcsRUFBRSxDQUFDO1lBQ3ZDLE1BQU0sTUFBTSxDQUFDLGVBQWUsQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN0QyxPQUFPLElBQUksZUFBZSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ3JDLENBQUM7SUFDSCxDQUFDO0lBRUQsc0JBQXNCLEdBQTJDLEtBQUssRUFBRSxJQUFZLEVBQUUsRUFBRSxDQUN0RixNQUFNLElBQUksQ0FBQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsSUFBSSxDQUFDLENBQUM7Q0FDbEQ7QUFtREQsY0FBYyxrQkFBa0IsQ0FBQztBQUNqQyxjQUFjLDJCQUEyQixDQUFDO0FBQzFDLGNBQWMsc0JBQXNCLENBQUM7QUFFckMsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGtCQUFrQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBNb25vQ29uZmlnIH0gZnJvbSBcIi4vZG90bmV0LmpzXCI7XHJcbmltcG9ydCB0eXBlIHsgU3BhbiB9IGZyb20gXCIuL1Jvc2x5bi9UZXh0LmpzXCI7XHJcbmltcG9ydCB7IHR5cGUgUmVtb3RlIH0gZnJvbSBcImh0dHBzOi8vdW5wa2cuY29tL2NvbWxpbmsvZGlzdC9lc20vY29tbGluay5tanNcIjtcclxuaW1wb3J0ICogYXMgQ29tbGluayBmcm9tIFwiaHR0cHM6Ly91bnBrZy5jb20vY29tbGluay9kaXN0L2VzbS9jb21saW5rLm1qc1wiO1xyXG5pbXBvcnQgeyBXYXNtU2hhcnBXb3JrZXIgfSBmcm9tIFwiLi9XYXNtU2hhcnBXb3JrZXIuanNcIjtcclxuaW1wb3J0IHsgQ29tcGlsYXRpb24gfSBmcm9tIFwiLi9XYXNtQ29tcGlsZXIuanNcIjtcclxuaW1wb3J0IHR5cGUgeyBXYXNtU2hhcnBXZWJXb3JrZXIgfSBmcm9tIFwiLi93b3JrZXIuanNcIjtcclxuaW1wb3J0IHR5cGUgeyBDb21waWxhdGlvbkludGVyb3AgfSBmcm9tIFwiLi9Db21waWxhdGlvbkludGVyb3AuanNcIjtcclxuaW1wb3J0IHsgV2VsbEtub3duVGFnQXJyYXkgfSBmcm9tIFwiLi9Sb3NseW4vV2VsbEtub3duVGFncy5qc1wiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBXYXNtU2hhcnBNb2R1bGVPcHRpb25zIHtcclxuICAvKipcclxuICAgKiBVUkwgdG8gcmVzb2x2ZSBhc3NlbWJsaWVzIGZyb20uXHJcbiAgICogQGRlZmF1bHQgaW1wb3J0Lm1ldGEudXJsXHJcbiAgICovXHJcbiAgYXNzZW1ibGllc1VybD86IHN0cmluZztcclxuICAvKipcclxuICAgKiBAZGVmYXVsdCBmYWxzZVxyXG4gICAqL1xyXG4gIGVuYWJsZURpYWdub3N0aWNUcmFjaW5nPzogYm9vbGVhbjtcclxuICAvKipcclxuICAgKiBodHRwczovL2dpdGh1Yi5jb20vZG90bmV0L3J1bnRpbWUvYmxvYi9hMjcwMTQwMjgxYTEzYWI4MmE0NDAxZGZmM2RhNmQyN2ZlNDk5MDg3L3NyYy9tb25vL3dhc2kvcnVudGltZS9kcml2ZXIuYyNMNDcwXHJcbiAgICogKiBkZWJ1Z19sZXZlbCA+IDAgZW5hYmxlcyBkZWJ1Z2dpbmcgYW5kIHNldHMgdGhlIGRlYnVnIGxvZyBsZXZlbCB0byBkZWJ1Z19sZXZlbFxyXG4gICAqICogZGVidWdfbGV2ZWwgPT0gMCBkaXNhYmxlcyBkZWJ1Z2dpbmcgYW5kIGVuYWJsZXMgaW50ZXJwcmV0ZXIgb3B0aW1pemF0aW9uc1xyXG4gICAqICogZGVidWdfbGV2ZWwgPCAwIGVuYWJsZWQgZGVidWdnaW5nIGFuZCBkaXNhYmxlcyBkZWJ1ZyBsb2dnaW5nLlxyXG4gICAqXHJcbiAgICogTm90ZTogd2hlbiBkZWJ1Z2dpbmcgaXMgZW5hYmxlZCBpbnRlcnByZXRlciBvcHRpbWl6YXRpb25zIGFyZSBkaXNhYmxlZC5cclxuICAgKlxyXG4gICAqIEBkZWZhdWx0IDBcclxuICAgKi9cclxuICBkZWJ1Z0xldmVsPzogbnVtYmVyO1xyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIFdhc21TaGFycE1vZHVsZUNhbGxiYWNrcyB7XHJcbiAgb25Db25maWdMb2FkZWQ/KGNvbmZpZzogTW9ub0NvbmZpZyk6IHZvaWQ7XHJcbiAgb25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3M/KGxvYWRlZFJlc291cmNlczogbnVtYmVyLCB0b3RhbFJlc291cmNlczogbnVtYmVyKTogdm9pZDtcclxufVxyXG5cclxuZXhwb3J0IHR5cGUgV2FzbVNoYXJwT3B0aW9ucyA9IHtcclxuICAvKipcclxuICAgKiBEaXNhYmxlIHRoZSB3ZWIgd29ya2VyLiBXZWIgd29ya2VycyBwcm92aWRlIGEgbGFyZ2UgcGVyZm9ybWFuY2UgYm9vc3QgYXMgY29tcGlsYXRpb24gYW5kXHJcbiAgICogZXhlY3V0aW9uIGNhbiBoYXBwZW4gaW4gdGhlIGJhY2tncm91bmQuIEhvd2V2ZXIgV2ViIFdvcmtlcnMgcmVxdWlyZSBhIEhUVFBTIFVSTC5cclxuICAgKi9cclxuICBkaXNhYmxlV2ViV29ya2VyPzogYm9vbGVhbjtcclxufSAmIFdhc21TaGFycE1vZHVsZU9wdGlvbnMgJlxyXG4gIFdhc21TaGFycE1vZHVsZUNhbGxiYWNrcztcclxuXHJcbmV4cG9ydCBjbGFzcyBXYXNtU2hhcnBNb2R1bGUge1xyXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgd29ya2VyOiBXYXNtU2hhcnBXb3JrZXIgfCBSZW1vdGU8V2FzbVNoYXJwV2ViV29ya2VyPikge31cclxuICBzdGF0aWMgYXN5bmMgaW5pdGlhbGl6ZUFzeW5jKG9wdGlvbnM/OiBXYXNtU2hhcnBPcHRpb25zKSB7XHJcbiAgICAvL1RPRE86IFJld3JpdGUgdGhpcyB1c2luZyBkeW5hbWljIGltcG9ydCBzbyB0aGF0IHdlIGRvIG5vdCBsb2FkIHdlYiB3b3JrZXIgY29kZSB3aGVuIGl0cyBkaXNhYmxlZCwgYW5kIHZpY2UgdmVyc2EuXHJcbiAgICBpZiAob3B0aW9ucz8uZGlzYWJsZVdlYldvcmtlcikge1xyXG4gICAgICBjb25zdCBtb2R1bGUgPSBhd2FpdCBXYXNtU2hhcnBXb3JrZXIuaW5pdGlhbGl6ZUFzeW5jKG9wdGlvbnMsIHtcclxuICAgICAgICBvbkNvbmZpZ0xvYWRlZDogb3B0aW9ucz8ub25Db25maWdMb2FkZWQsXHJcbiAgICAgICAgb25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3M6IG9wdGlvbnM/Lm9uRG93bmxvYWRSZXNvdXJjZVByb2dyZXNzLFxyXG4gICAgICB9KTtcclxuICAgICAgcmV0dXJuIG5ldyBXYXNtU2hhcnBNb2R1bGUobW9kdWxlKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IHdvcmtlciA9IG5ldyBXb3JrZXIobmV3IFVSTChcIi4vd29ya2VyLmpzXCIsIGltcG9ydC5tZXRhLnVybCkuaHJlZiwgeyB0eXBlOiBcIm1vZHVsZVwiIH0pO1xyXG4gICAgICBjb25zdCBXb3JrZXJDbGFzcyA9IENvbWxpbmsud3JhcDx0eXBlb2YgV2FzbVNoYXJwV2ViV29ya2VyPih3b3JrZXIpO1xyXG5cclxuICAgICAgLy9mdW5jdGlvbnMgYXJlIG5vdCBzdHJ1Y3R1cmVkIGNsb25lYWJsZVxyXG4gICAgICBpZiAob3B0aW9ucz8ub25Db25maWdMb2FkZWQgfHwgb3B0aW9ucz8ub25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3MpIHtcclxuICAgICAgICBjb25zdCBvbkNvbmZpZ0xvYWRlZCA9IG9wdGlvbnMub25Db25maWdMb2FkZWQ7XHJcbiAgICAgICAgY29uc3Qgb25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3MgPSBvcHRpb25zLm9uRG93bmxvYWRSZXNvdXJjZVByb2dyZXNzO1xyXG4gICAgICAgIHdvcmtlci5hZGRFdmVudExpc3RlbmVyKFwibWVzc2FnZVwiLCAoZSkgPT4ge1xyXG4gICAgICAgICAgaWYgKGUuZGF0YS50eXBlICYmIGUuZGF0YS50eXBlID09PSBcImNvbmZpZ0xvYWRlZFwiICYmIGUuZGF0YS5jb25maWcpIHtcclxuICAgICAgICAgICAgb25Db25maWdMb2FkZWQ/LihlLmRhdGEuY29uZmlnKTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBpZiAoZS5kYXRhLnR5cGUgJiYgZS5kYXRhLnR5cGUgPT09IFwiZG93bmxvYWRSZXNvdXJjZVByb2dyZXNzXCIpIHtcclxuICAgICAgICAgICAgb25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3M/LihlLmRhdGEubG9hZGVkUmVzb3VyY2VzLCBlLmRhdGEudG90YWxSZXNvdXJjZXMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBkZWxldGUgb3B0aW9ucy5vbkNvbmZpZ0xvYWRlZDtcclxuICAgICAgICBkZWxldGUgb3B0aW9ucy5vbkRvd25sb2FkUmVzb3VyY2VQcm9ncmVzcztcclxuICAgICAgfVxyXG5cclxuICAgICAgY29uc3QgbW9kdWxlID0gYXdhaXQgbmV3IFdvcmtlckNsYXNzKCk7XHJcbiAgICAgIGF3YWl0IG1vZHVsZS5pbml0aWFsaXplQXN5bmMob3B0aW9ucyk7XHJcbiAgICAgIHJldHVybiBuZXcgV2FzbVNoYXJwTW9kdWxlKG1vZHVsZSk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjcmVhdGVDb21waWxhdGlvbkFzeW5jOiAoY29kZTogc3RyaW5nKSA9PiBQcm9taXNlPENvbXBpbGF0aW9uPiA9IGFzeW5jIChjb2RlOiBzdHJpbmcpID0+XHJcbiAgICBhd2FpdCB0aGlzLndvcmtlci5jcmVhdGVDb21waWxhdGlvbkFzeW5jKGNvZGUpO1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBDb21wbGV0aW9uSXRlbSA9IHtcclxuICBkaXNwbGF5VGV4dDogc3RyaW5nO1xyXG4gIGZpbHRlclRleHQ6IHN0cmluZztcclxuICBzb3J0VGV4dDogc3RyaW5nO1xyXG4gIGlubGluZURlc2NyaXB0aW9uOiBzdHJpbmc7XHJcbiAgdGFnczogV2VsbEtub3duVGFnQXJyYXk7XHJcbiAgc3BhbjogU3BhbjtcclxufTtcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgQXNzZW1ibHlFeHBvcnRzIHtcclxuICBXYXNtU2hhcnA6IHtcclxuICAgIENvcmU6IHtcclxuICAgICAgQ29tcGlsYXRpb25JbnRlcm9wOiBDb21waWxhdGlvbkludGVyb3A7XHJcbiAgICB9O1xyXG4gIH07XHJcbn1cclxuXHJcbmV4cG9ydCB0eXBlIERpYWdub3N0aWNTZXZlcml0eSA9IFwiRXJyb3JcIiB8IFwiV2FybmluZ1wiIHwgXCJJbmZvXCIgfCBcIkhpZGRlblwiO1xyXG5cclxuLy9UT0RPOiBNYXAgRGVzY3JpcHRpb25Qcm9wZXJ0eT8/XHJcbi8qXHJcbnByb3BlcnRpZXM6IHtEZXNjcmlwdGlvblByb3BlcnR5OiAnVGV4dHxib29sIEtleXdvcmQnfVxyXG5leHRyYWN0IFwiYm9vbCBLZXl3b3JkXCIgZnJvbSB0aGlzIHRvIG1hdGNoIGhvdyB0aGlzIGlzIGRpc3BsYXllZCBpbiBWU1xyXG4qL1xyXG4vL1JlcXVpcmVzIHNlcmlhbGl6aW5nIHByb3BlcnRpZXNcclxuXHJcbmV4cG9ydCBpbnRlcmZhY2UgRGlhZ25vc3RpYyB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBtZXNzYWdlOiBzdHJpbmc7XHJcbiAgbG9jYXRpb246IFNwYW47XHJcbiAgc2V2ZXJpdHk6IERpYWdub3N0aWNTZXZlcml0eTtcclxufVxyXG5cclxuaW50ZXJmYWNlIFJ1blJlc3VsdFN1Y2Nlc3Mge1xyXG4gIHN0ZE91dDogc3RyaW5nO1xyXG4gIHN0ZEVycjogc3RyaW5nO1xyXG4gIHN1Y2Nlc3M6IHRydWU7XHJcbiAgZGlhZ25vc3RpY3M6IFtdO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUnVuUmVzdWx0RmFpbHVyZSB7XHJcbiAgc3RkT3V0OiBudWxsO1xyXG4gIHN0ZEVycjogbnVsbDtcclxuICBzdWNjZXNzOiBmYWxzZTtcclxuICBkaWFnbm9zdGljczogRGlhZ25vc3RpY1tdO1xyXG59XHJcblxyXG5leHBvcnQgdHlwZSBSdW5SZXN1bHQgPSBSdW5SZXN1bHRTdWNjZXNzIHwgUnVuUmVzdWx0RmFpbHVyZTtcclxuXHJcbmV4cG9ydCAqIGZyb20gXCIuL1Jvc2x5bi9UZXh0LmpzXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL1Jvc2x5bi9XZWxsS25vd25UYWdzLmpzXCI7XHJcbmV4cG9ydCAqIGZyb20gXCIuL1dhc21TaGFycFdvcmtlci5qc1wiO1xyXG5cclxuZXhwb3J0IHsgQ29tcGlsYXRpb24gfSBmcm9tIFwiLi9Db21waWxhdGlvbi5qc1wiO1xyXG4iXX0=