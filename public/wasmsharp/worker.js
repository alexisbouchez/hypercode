//There does not appear to be a good way to reference web worker and DOM types in the same project for different files.
//For now, just comment in the above if web worker types are desired (and ignore any DOM types)
// /// <reference lib="webworker" />
import * as Comlink from "https://unpkg.com/comlink/dist/esm/comlink.mjs";
import { Compilation } from "./Compilation";
import { initializeWasmSharpModule } from "./initializeWasmSharpModule";
export class WasmSharpWebWorker {
    interop;
    constructor() {
        return this;
    }
    async initializeAsync(options) {
        const onConfigLoaded = (config) => postMessage({ type: "configLoaded", config: null });
        const onDownloadResourceProgress = (loaded, total) => postMessage({
            type: "downloadResourceProgress",
            loadedResources: loaded,
            totalResources: total,
        });
        this.interop = await initializeWasmSharpModule(options, {
            onConfigLoaded,
            onDownloadResourceProgress,
        });
    }
    createCompilationAsync(code) {
        this.#ensureInitialized();
        return Comlink.proxy(Compilation.create(code, this.interop));
    }
    #ensureInitialized() { }
}
Comlink.expose(WasmSharpWebWorker);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid29ya2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vd29ya2VyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLHVIQUF1SDtBQUN2SCwrRkFBK0Y7QUFDL0Ysb0NBQW9DO0FBRXBDLE9BQU8sS0FBSyxPQUFPLE1BQU0sZ0RBQWdELENBQUM7QUFDMUUsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUU1QyxPQUFPLEVBQUUseUJBQXlCLEVBQUUsTUFBTSw2QkFBNkIsQ0FBQztBQUd4RSxNQUFNLE9BQU8sa0JBQWtCO0lBQ3JCLE9BQU8sQ0FBc0I7SUFDckM7UUFDRSxPQUFPLElBQUksQ0FBQztJQUNkLENBQUM7SUFDRCxLQUFLLENBQUMsZUFBZSxDQUFDLE9BQWE7UUFDakMsTUFBTSxjQUFjLEdBQUcsQ0FBQyxNQUFrQixFQUFFLEVBQUUsQ0FDNUMsV0FBVyxDQUFDLEVBQUUsSUFBSSxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsSUFBSyxFQUFFLENBQUMsQ0FBQztRQUN2RCxNQUFNLDBCQUEwQixHQUFHLENBQUMsTUFBYyxFQUFFLEtBQWEsRUFBRSxFQUFFLENBQ25FLFdBQVcsQ0FBQztZQUNWLElBQUksRUFBRSwwQkFBMEI7WUFDaEMsZUFBZSxFQUFFLE1BQU07WUFDdkIsY0FBYyxFQUFFLEtBQUs7U0FDdEIsQ0FBQyxDQUFDO1FBQ0wsSUFBSSxDQUFDLE9BQU8sR0FBRyxNQUFNLHlCQUF5QixDQUFDLE9BQU8sRUFBRTtZQUN0RCxjQUFjO1lBQ2QsMEJBQTBCO1NBQzNCLENBQUMsQ0FBQztJQUNMLENBQUM7SUFDRCxzQkFBc0IsQ0FBQyxJQUFZO1FBQ2pDLElBQUksQ0FBQyxrQkFBa0IsRUFBRSxDQUFDO1FBQzFCLE9BQU8sT0FBTyxDQUFDLEtBQUssQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsa0JBQWtCLEtBQUksQ0FBQztDQUN4QjtBQUVELE9BQU8sQ0FBQyxNQUFNLENBQUMsa0JBQWtCLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vVGhlcmUgZG9lcyBub3QgYXBwZWFyIHRvIGJlIGEgZ29vZCB3YXkgdG8gcmVmZXJlbmNlIHdlYiB3b3JrZXIgYW5kIERPTSB0eXBlcyBpbiB0aGUgc2FtZSBwcm9qZWN0IGZvciBkaWZmZXJlbnQgZmlsZXMuXHJcbi8vRm9yIG5vdywganVzdCBjb21tZW50IGluIHRoZSBhYm92ZSBpZiB3ZWIgd29ya2VyIHR5cGVzIGFyZSBkZXNpcmVkIChhbmQgaWdub3JlIGFueSBET00gdHlwZXMpXHJcbi8vIC8vLyA8cmVmZXJlbmNlIGxpYj1cIndlYndvcmtlclwiIC8+XHJcblxyXG5pbXBvcnQgKiBhcyBDb21saW5rIGZyb20gXCJodHRwczovL3VucGtnLmNvbS9jb21saW5rL2Rpc3QvZXNtL2NvbWxpbmsubWpzXCI7XHJcbmltcG9ydCB7IENvbXBpbGF0aW9uIH0gZnJvbSBcIi4vQ29tcGlsYXRpb25cIjtcclxuaW1wb3J0IHR5cGUgeyBNb25vQ29uZmlnIH0gZnJvbSBcIi4vZG90bmV0XCI7XHJcbmltcG9ydCB7IGluaXRpYWxpemVXYXNtU2hhcnBNb2R1bGUgfSBmcm9tIFwiLi9pbml0aWFsaXplV2FzbVNoYXJwTW9kdWxlXCI7XHJcbmltcG9ydCB0eXBlIHsgQ29tcGlsYXRpb25JbnRlcm9wIH0gZnJvbSBcIi4vQ29tcGlsYXRpb25JbnRlcm9wXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgV2FzbVNoYXJwV2ViV29ya2VyIHtcclxuICBwcml2YXRlIGludGVyb3AhOiBDb21waWxhdGlvbkludGVyb3A7XHJcbiAgY29uc3RydWN0b3IoKSB7XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcbiAgYXN5bmMgaW5pdGlhbGl6ZUFzeW5jKG9wdGlvbnM/OiBhbnkpIHtcclxuICAgIGNvbnN0IG9uQ29uZmlnTG9hZGVkID0gKGNvbmZpZzogTW9ub0NvbmZpZykgPT5cclxuICAgICAgcG9zdE1lc3NhZ2UoeyB0eXBlOiBcImNvbmZpZ0xvYWRlZFwiLCBjb25maWc6IG51bGwhIH0pO1xyXG4gICAgY29uc3Qgb25Eb3dubG9hZFJlc291cmNlUHJvZ3Jlc3MgPSAobG9hZGVkOiBudW1iZXIsIHRvdGFsOiBudW1iZXIpID0+XHJcbiAgICAgIHBvc3RNZXNzYWdlKHtcclxuICAgICAgICB0eXBlOiBcImRvd25sb2FkUmVzb3VyY2VQcm9ncmVzc1wiLFxyXG4gICAgICAgIGxvYWRlZFJlc291cmNlczogbG9hZGVkLFxyXG4gICAgICAgIHRvdGFsUmVzb3VyY2VzOiB0b3RhbCxcclxuICAgICAgfSk7XHJcbiAgICB0aGlzLmludGVyb3AgPSBhd2FpdCBpbml0aWFsaXplV2FzbVNoYXJwTW9kdWxlKG9wdGlvbnMsIHtcclxuICAgICAgb25Db25maWdMb2FkZWQsXHJcbiAgICAgIG9uRG93bmxvYWRSZXNvdXJjZVByb2dyZXNzLFxyXG4gICAgfSk7XHJcbiAgfVxyXG4gIGNyZWF0ZUNvbXBpbGF0aW9uQXN5bmMoY29kZTogc3RyaW5nKTogQ29tcGlsYXRpb24ge1xyXG4gICAgdGhpcy4jZW5zdXJlSW5pdGlhbGl6ZWQoKTtcclxuICAgIHJldHVybiBDb21saW5rLnByb3h5KENvbXBpbGF0aW9uLmNyZWF0ZShjb2RlLCB0aGlzLmludGVyb3ApKTtcclxuICB9XHJcblxyXG4gICNlbnN1cmVJbml0aWFsaXplZCgpIHt9XHJcbn1cclxuXHJcbkNvbWxpbmsuZXhwb3NlKFdhc21TaGFycFdlYldvcmtlcik7XHJcbiJdfQ==